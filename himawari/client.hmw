サーバーIP=「192.168.11.81」
TCPポート=3000

母艦の、タイトルは、「ChatGPT」
ステータスバーを、作る
その、テキストは、「{サーバーIP}へ接続します」



サーバー接続処理
メインUI描画

ステータスバーの、テキストは、「モデルの取得中...」
「/models\n」を、TCP送信

会話履歴は、「」
会話履歴レンダリング


待機

＊サーバー接続処理
サーバーIPへ、TCP接続。

もし、TCP接続状態が、「接続中」ならば、（
    受信イベントに、TCP受信処理設定。
）
戻る

＊メインUI描画

新しい会話メニューを、作る
その、イベントは、新しい会話イベント
モデル変更メニューを、作る
その、イベントは、モデル変更イベント

会話履歴メモを、作る
その、レイアウトは、「全体」
その、編集は、いいえ
その、フォントサイズは、9
その、折り返しは、はい

メッセージパネルを、作る
その、レイアウトは、「下」
その、高さは、26
メッセージ入力エディタを、作る
その、レイアウトは、「全体」
その、キー押した時は、（
	もし、押されたキー=13{Enter}ならば、送信イベント
）
メッセージ送信ボタンを、作る
その、レイアウトは、「右」
その、フォントサイズは、10
その、幅は、50
その、テキストは、「送信」
その、イベントは、送信イベント
メッセージ入力エディタを、メッセージパネルへ、乗せる
メッセージ送信ボタンを、メッセージパネルへ、乗せる

メッセージ入力エディタに、注目

戻る

＊新しい会話イベント
「/clear\n」を、TCP送信
会話履歴は、「」
会話履歴レンダリング
戻る

＊モデル変更イベント

「どのモデルに変更しますか？\n現在は{利用中モデル}を使用しています。」を、利用可能モデルの、リストで選択
もし、それが、「」ならば、戻る
利用中モデルは、それ

「/model {利用中モデル}\n」を、TCP送信
戻る

＊会話履歴レンダリング
会話履歴メモは、会話履歴
戻る

＊送信イベント

もし、（メッセージ送信ボタンの、有効）が、いいえならば、戻る

メッセージ入力エディタの、文字コードをUTF8に変換
送信内容は、それ
会話履歴は、会話履歴＆「あなた: ｛メッセージ入力エディタ｝\n\n」
ステータスバーの、テキストは、「会話を送信中...」
送信内容＆「￥ｎ」を、TCP送信。
会話履歴レンダリング
メッセージ入力エディタは、「」
メッセージ送信ボタンの、有効は、いいえ

ステータスバーの、テキストは、「応答の待機中」
0.5秒後に、読込アニメーションへ飛ぶ、タイマー設定。

戻る

＊読込アニメーション
ステータスバーの、テキストは、（ステータスバーの、テキスト）＆「.」
0.5秒後に、読込アニメーションへ飛ぶ、タイマー設定。
戻る

＊受信イベント
タイマー解除。
ステータスバーの、テキストは、「応答の読込中...」

TCP文字列の、文字コードをSJISに変換。
レスポンスは、それ
レスポンスの、『response\command』を、XMLテキストデータ取得。
コマンドは、それ

コマンドで、条件分岐
「models」の時、（
	レスポンスの、『response\available_models』を、XMLテキストデータ取得。
    利用可能モデル=それ
    レスポンスの、『response\current_model』を、XMLテキストデータ取得。
    利用中モデル=それ
）
「clear」の時、（
	レスポンスの、『response\message』を、XMLテキストデータ取得。
    アンエスケープ処理。
    言う
）
「model_change」の時、（
	レスポンスの、『response\message』を、XMLテキストデータ取得。
    アンエスケープ処理。
    言う
）
その他の時、（
	レスポンスの、『response\model』を、XMLテキストデータ取得。
	モデルは、それ
	レスポンスの、『response\content』を、XMLテキストデータ取得。
	アンエスケープ処理。
	応答は、それ
	会話履歴は、会話履歴＆「ChatGPT(｛モデル｝): ｛応答｝\n\n------\n\n\n」
	会話履歴レンダリング
）

メッセージ送信ボタンの、有効は、はい
ステータスバーの、テキストは、「準備完了」
戻る

＊アンエスケープ処理（？を）
引数取得
それの、『&lt;』を、『<』に、置換
それの、『&gt;』を、『>』に、置換
それの、『&ap;』を、『&』に、置換
それの、『&quot;』を、『"』に、置換
それの、『&apos;』を、『'』に、置換
戻る
